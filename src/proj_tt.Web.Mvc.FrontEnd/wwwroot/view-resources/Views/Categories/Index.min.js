(function(n){function o(n,r){abp.message.confirm(abp.utils.formatString(t("AreYouSureWantToDelete"),r),t("AreYouSure"),r=>{r&&f.delete(n).done(()=>{abp.message.success(t("SuccessfullyDeleted"),t("Success")),i.ajax.reload()}).fail(n=>{let i=t("DeleteError");n.message&&(i=n.message);abp.message.error(t(i),t("Fail"))})})}var f=abp.services.app.categories,t=abp.localization.getSource("proj_tt"),u=n("#createModal"),r=u.find("form"),e=n("#CategoriesTable"),i=e.DataTable({paging:!0,serverSide:!0,listAction:{ajaxFunction:f.getAllCategories,inputFilter:function(){var t=n("#CategoriesSearchForm").serializeFormToObject(!0);return console.log("Dữ liệu gửi đi:",t),t}},buttons:[{name:"refresh",text:'<i class="fas fa-redo-alt"><\/i>',action:()=>i.draw(!1)}],responsive:{details:{type:"column"}},columnDefs:[{targets:0,className:"control",defaultContent:""},{targets:1,data:"nameCategory",sortable:!1},{targets:2,data:"creationTime",sortable:!1,render:function(n){if(!n)return"";const t=new Date(n);return t.toLocaleString("vi-VN")}},{targets:3,data:"lastModificationTime",sortable:!1,render:function(n){if(!n)return"";const t=new Date(n);return t.toLocaleString("vi-VN")}},{targets:4,data:null,sortable:!1,autoWidth:!1,defaultContent:"",render:(n,i,r)=>[`<div class="dropdown">
                            <button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="actionDropdown_${r.id}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                ${t("Actions")}
                            </button>
                            <div class="dropdown-menu p-0" aria-labelledby="actionDropdown_${r.id}">
                                <button type="button" class="dropdown-item text-secondary edit-category" data-category-id="${r.id}" data-toggle="modal" data-target="#editModal">
                                    <i class="fas fa-edit mr-2"></i> ${t("Edit")}
                                </button>
                                <div class="dropdown-divider m-0"></div>
                                <button type="button" class="dropdown-item text-danger delete-category" data-category-id="${r.id}" data-category-name="${r.nameCategory}" data-toggle="modal" data-target="#deleteModal">
                                    <i class="fas fa-trash mr-2"></i> ${t("Delete")}
                                </button>
                            </div>
                        </div>`].join("")}]});r.validate({rules:{NameCategory:{required:!0,minlength:1,maxlength:100}},messages:{NameCategory:{required:"Tên danh mục không được để trống",minlength:"Tên ít nhất 1 ký tự",maxlength:"Tên tối đa 100 ký tự"}}});r.find(".save-button").on("click",n=>{if(n.preventDefault(),r.valid()){var e=r.serializeFormToObject();abp.ui.setBusy(u);f.create(e).done(function(){u.modal("hide");r[0].reset();abp.message.success(t("SuccessfullyRegistered"),t("Success"));i.ajax.reload()}).always(function(){abp.ui.clearBusy(u)})}});n(document).on("click",".edit-category",function(t){var i=n(this).attr("data-category-id");t.preventDefault();abp.ajax({url:abp.appPath+"Categories/EditModal?categoryId="+i,type:"POST",dataType:"html",success:function(t){n("#editModal div.modal-content").html(t)},error:function(){}})});abp.event.on("category.edited",()=>{i.ajax.reload()});n(document).on("click",".delete-category",function(){var t=n(this).attr("data-category-id"),i=n(this).attr("data-category-name");o(t,i)});n(".btn-search").on("click",()=>{i.ajax.reload()});n(".txt-search").on("keypress",n=>{if(n.which==13)return i.ajax.reload(),!1})})(jQuery);